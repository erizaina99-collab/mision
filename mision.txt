<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>MisiÃ³n EpidemiolÃ³gica: HTA</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-pink-100 min-h-screen flex items-center justify-center">

<div class="absolute top-4 right-4 bg-white p-3 rounded-xl shadow w-64">
  <h3 class="font-bold text-center">ğŸ† Ranking</h3>
  <ol id="ranking" class="text-sm list-decimal list-inside"></ol>
</div>

<div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-2xl text-center">
  <h1 class="text-3xl font-bold mb-4">ğŸ® MisiÃ³n EpidemiolÃ³gica</h1>
  <p class="mb-4">Tras la pista de la HipertensiÃ³n</p>

  <div id="game"></div>

  <p id="score" class="mt-4 font-bold">PuntuaciÃ³n: 100 ğŸ¤©</p>
</div>

<script>
let score = 100;
let level = 0;
let player = "";

const levels = [
  {
    q: "Nivel 1ï¸âƒ£ Â¿CuÃ¡l es la pregunta PICO correcta para un estudio de prevalencia de HTA?",
    options: [
      "Â¿La medicaciÃ³n X reduce la HTA frente a placebo?",
      "Â¿CuÃ¡l es la prevalencia de HTA en adultos de la poblaciÃ³n general?",
      "Â¿QuÃ© tratamiento es mÃ¡s eficaz para HTA?"
    ],
    correct: 1
  },
  {
    q: "Nivel 2ï¸âƒ£ Estima la media aproximada de estas PAD: 78, 82, 85, 90, 88, 76, 84, 92, 80, 86",
    options: [
      "70 mmHg",
      "84 mmHg",
      "95 mmHg"
    ],
    correct: 1
  },
  {
    q: "Nivel 3ï¸âƒ£ El IC 95% de la media PAD es 77,49 â€“ 90,51. El valor 74,4 mmHg:",
    options: [
      "EstÃ¡ dentro del IC",
      "EstÃ¡ fuera del IC",
      "No se puede saber"
    ],
    correct: 1
  },
  {
    q: "Nivel 4ï¸âƒ£ En una consulta: 58 HTA de 200 pacientes. Â¿Prevalencia?",
    options: [
      "15%",
      "29%",
      "40%"
    ],
    correct: 1
  },
  {
    q: "Nivel 5ï¸âƒ£ Tabla 2x2 educaciÃ³n sanitaria â€“ HTA\n\nEducaciÃ³n SÃ: 20 HTA / 80 no HTA\nEducaciÃ³n NO: 40 HTA / 60 no HTA\n\nChiÂ² p = 0,003. Â¿ConclusiÃ³n?",
    options: [
      "No existe relaciÃ³n",
      "Existe asociaciÃ³n estadÃ­sticamente significativa",
      "Demuestra causalidad"
    ],
    correct: 1
  },
  {
    q: "Nivel 6ï¸âƒ£ SegÃºn GuÃ­as de PrÃ¡ctica ClÃ­nica, Â¿quÃ© decisiÃ³n es correcta?",
    options: [
      "Aplicar solo los datos locales",
      "Reforzar educaciÃ³n sanitaria y cribado de HTA",
      "No hacer cambios"
    ],
    correct: 1
  }
];

function startGame() {
  const g = document.getElementById("game");
  g.innerHTML = `
    <p class="mb-4">Introduce tu nombre:</p>
    <input id="name" class="border p-2 rounded mb-4 w-full"/>
    <button onclick="begin()" class="bg-blue-400 text-white px-4 py-2 rounded hover:bg-yellow-400">
      Empezar
    </button>
  `;
}

function begin() {
  player = document.getElementById("name").value || "Jugador/a";
  showLevel();
}

function showLevel() {
  if (level >= levels.length) return endGame();

  const l = levels[level];
  const g = document.getElementById("game");

  g.innerHTML = `
    <p class="font-semibold mb-4">${l.q.replace(/\n/g,"<br>")}</p>
    ${l.options.map((o,i)=>`
      <button onclick="answer(${i})"
        class="block w-full mb-2 bg-blue-300 text-white py-2 rounded hover:bg-green-400">
        ${o}
      </button>
    `).join("")}
  `;
}

function answer(i) {
  if (i === levels[level].correct) {
    score += 10;
  } else {
    score -= 10;
  }
  level++;
  updateScore();
  showLevel();
}

function updateScore() {
  let emoji = score >= 100 ? "ğŸ¤©" : score >= 70 ? "ğŸ™‚" : "ğŸ˜¢";
  document.getElementById("score").innerText = `PuntuaciÃ³n: ${score} ${emoji}`;
}

function endGame() {
  saveScore();
  document.getElementById("game").innerHTML = `
    <h2 class="text-2xl font-bold mb-4">ğŸ‰ Juego completado</h2>
    <p class="mb-4">${player}, has finalizado la misiÃ³n.</p>
    <p class="font-bold">PuntuaciÃ³n final: ${score}</p>
  `;
  loadRanking();
}

function saveScore() {
  let r = JSON.parse(localStorage.getItem("ranking") || "[]");
  r.push({name: player, score});
  r.sort((a,b)=>b.score-a.score);
  r = r.slice(0,10);
  localStorage.setItem("ranking", JSON.stringify(r));
}

function loadRanking() {
  let r = JSON.parse(localStorage.getItem("ranking") || "[]");
  document.getElementById("ranking").innerHTML =
    r.map(e=>`<li>${e.name}: ${e.score}</li>`).join("");
}

startGame();
loadRanking();
</script>

</body>
</html>
